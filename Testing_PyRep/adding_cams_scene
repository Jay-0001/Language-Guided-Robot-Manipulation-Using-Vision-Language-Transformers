from os.path import dirname, join, abspath
from pyrep import PyRep
from pyrep.objects.vision_sensor import VisionSensor
from pyrep.objects.dummy import Dummy
import numpy as np

SCENE_FILE = join(dirname(abspath(__file__)), 'scene_panda_6_spheres.ttt')
SAVE_AS    = join(dirname(abspath(__file__)), 'scene_panda_with_cams.ttt')

# Camera parameters
RESOLUTION = [640, 480]
FOV = 60                # degrees
NEAR = 0.01
FAR  = 2.0

# Position presets relative to world
CAM_POSITIONS = {
    "cam_front": [0.45, 0.0, 1.00],     # in front of workspace
    "cam_left":  [0.75, -0.45, 1.00],   # left angled
    "cam_right": [0.75, 0.45, 1.00],    # right angled
    "cam_top":   [0.80, 0.0, 1.50],     # top view
}

# Orientations (Euler angles in degrees)
CAM_ORIENTS = {
    "cam_front": [0, 0, 0],
    "cam_left":  [0, 0, 45],
    "cam_right": [0, 0, -45],
    "cam_top":   [-90, 0, 0],   # looking down
}

pr = PyRep()
pr.launch(SCENE_FILE, headless=False)
pr.start()

print("Adding cameras to scene...")

created_cams = []

for cam_name in CAM_POSITIONS:
    pos = CAM_POSITIONS[cam_name]
    eul = CAM_ORIENTS[cam_name]

    cam = VisionSensor.create(
        resolution=RESOLUTION,
        position=pos,
        orientation=[np.radians(e) for e in eul],
        near_clipping=NEAR,
        far_clipping=FAR
    )
    cam.set_name(cam_name)
    cam.set_perspective_angle(FOV)

    created_cams.append(cam)
    print(f"â†’ Created {cam_name} at {pos}, orientation {eul} deg")

# Step simulation briefly
for _ in range(10):
    pr.step()

print("Saving scene with cameras as:", SAVE_AS)
pr.export_scene(SAVE_AS)

pr.stop()
print("Finished. Cameras successfully added.")
